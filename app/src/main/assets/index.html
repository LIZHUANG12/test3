<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文小说错别字修改游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        /* Header Styles */
        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            text-align: center;
            padding: 32px 24px;
            position: relative;
            overflow: hidden;
        }

        .header-gradient h1 {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            margin-top: 60px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .coins-icon {
            position: absolute;
            top: 16px;
            left: 16px;
            color: #ffd700;
            font-size: 24px;
            animation: bounce 2s infinite;
        }

        .top-right-controls {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .collect-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            transition: all 0.3s ease;
        }

        .collect-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .gift-icon {
            color: #ffd700;
            font-size: 24px;
            animation: bounce 2s infinite;
            animation-delay: 0.5s;
        }

        /* Task List Styles */
        .task-list {
            padding: 0 16px 24px;
            margin-bottom: 100px;
        }

        .task-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 12px;
            margin-bottom: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.15);
        }

        .task-card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .task-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .task-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .task-icon.completed {
            background: #10b981;
        }

        .task-icon.pending {
            background: #3b82f6;
        }

        .task-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .task-details p {
            font-size: 14px;
            color: #6b7280;
        }

        .task-details p.completed {
            color: #059669;
        }

        .task-right {
            text-align: right;
        }

        .task-reward {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .task-reward.completed {
            color: #059669;
        }

        .task-reward.pending {
            color: #ef4444;
        }

        .task-action-btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-action-btn.completed {
            background: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }

        .task-action-btn.pending {
            background: #3b82f6;
            color: white;
        }

        .task-action-btn.pending:hover {
            background: #2563eb;
        }

        /* Floating Stats */
        .floating-stats {
            position: fixed;
            bottom: 16px;
            left: 16px;
            right: 16px;
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }

        .stat-icon {
            color: #f59e0b;
            font-size: 20px;
        }

        .stat-text {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }

        /* Modal Styles */
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 16px;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            height: 100%;
            display: flex;
            flex-direction: column;
            color: #333;
            overflow: hidden;
            animation: redPacket 1s ease-out;
        }

        .modal-header {
            background: linear-gradient(to right, #ef4444, #ec4899);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-reward {
            color: #fde047;
            font-weight: 700;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-text-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            line-height: 1.8;
            font-size: 16px;
            background: #f9fafb;
            border-radius: 8px;
            margin: 20px;
            user-select: none;
            min-height: 400px;
        }

        .modal-text-content span {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-text-content span:hover {
            background: #fef3c7;
        }

        .modal-text-content span.clicked {
            background: #fecaca;
            color: #991b1b;
            font-weight: 600;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            background: white;
            flex-shrink: 0;
        }

        .submit-btn {
            width: 100%;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-height: 56px;
        }

        .submit-btn:hover {
            background: #059669;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        /* Reward Notification */
        .reward-notification {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            background: linear-gradient(to right, #fbbf24, #f59e0b);
            color: #92400e;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: coinFlip 0.6s ease-in-out;
        }

        .reward-notification .coins-large {
            font-size: 48px;
            margin-bottom: 8px;
            animation: bounce 2s infinite;
        }

        .reward-notification h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .reward-notification .amount {
            font-size: 24px;
            font-weight: 700;
            color: #dc2626;
            margin-bottom: 4px;
        }

        .reward-notification .status {
            font-size: 14px;
        }

        /* Animations */
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
            40%, 43% { transform: translateY(-10px); }
            70% { transform: translateY(-5px); }
            90% { transform: translateY(-2px); }
        }

        @keyframes coinFlip {
            0% { transform: translate(-50%, -50%) rotateY(0deg) scale(1); opacity: 0; }
            50% { transform: translate(-50%, -50%) rotateY(180deg) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotateY(360deg) scale(1); opacity: 1; }
        }

        @keyframes redPacket {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        /* Icons */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .modal-content {
                max-width: 500px;
                max-height: 90vh;
                margin: auto;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-gradient">
            <div class="coins-icon">💰</div>
            <div class="top-right-controls">
                <button class="collect-btn" onclick="handleResetTasks()">领取任务</button>
                <div class="gift-icon">🎁</div>
            </div>
            <h1>小说错别字修改</h1>
        </div>

        <!-- Task List -->
        <div class="task-list" id="taskList">
            <!-- Tasks will be dynamically generated -->
        </div>

        <!-- Floating Stats -->
        <div class="floating-stats">
            <div class="stat-card">
                <div class="stat-icon">💳</div>
                <div class="stat-text">余额: ¥<span id="balance">30.00</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🏆</div>
                <div class="stat-text">已完成: <span id="completed">0</span></div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal-backdrop" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-reward">报酬: ¥<span id="modalReward">48.00</span></div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-text-content" id="modalContent">
                <!-- Task content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="submit-btn" onclick="submitTask()">
                    <span>✓</span>
                    提交
                </button>
            </div>
        </div>
    </div>

    <!-- Reward Notification -->
    <div class="reward-notification" id="rewardNotification">
        <div class="coins-large">💰</div>
        <h3>恭喜获得</h3>
        <div class="amount" id="rewardAmount">+48.00</div>
        <div class="status">已到账</div>
    </div>

    <script>
        // 用户数据（完全按照线上版本）
        let userData = {
            id: 1,
            username: "default_user",
            balance: "960.00",
            completed: 20
        };

        // 完整的20个"非强迫宠爱"任务数据（使用线上真实数据）
        const chineseTexts = [
            {
                id: 1,
                content: `第1章 非强迫
下午三点，正值盛夏最炎热的时间。太阳毒辣地烤着地面，空气里蔓延着阵阵灼意，即便是被绿荫层层环绕的翡翠湖，今天似乎也抵挡不住这份燥热。
"不是说下个星期的飞机吗，怎么提前回来了？"
"她做事难道还要跟我们提前报备。"
"让开，快点，别挡着我！"
湖内别墅区六幢，一群人在大厅里横冲直撞。来来往往的混乱里，一个微胖的中年男人站在客厅中央，严肃神情里同样不难看出几分紧张。
"都给我仔细着点！"
"空调不能高也不能低，一定得是22度。"
"楼梯的扶手再去擦一遍。"
"花摆到指定位置了没？"
正说着，男人视线一转，落在正前方的观景鱼缸上。他狗偻着身体凑近，微顿几秒，忽地如临大敌地拔高了声音，"我不是说了这里的鱼数量一定得是6的倍数吗？怎么只有13条！"
佣人纷纷上前围观，有人大着胆子问："为什么一定要6的倍数？"
中年男人气得拍他头，"雇主的要求轮得到你问为什么？赶紧去买5条来补上！"

点击文本中任意字符即可提交任务。`,
                typos: [
                    { start: 329, end: 330, incorrect: "狗", correct: "佝" }
                ]
            },
            {
                id: 2,
                content: `第2章 非强迫
在京市坊间的传闻里，周时聿和裴祤宁的关系一直很差，甚至到了水火不容的地步。
一个是裴家千金，一个是周家少爷，两家都是顶级豪门，在京市乃至整个国内有着举足轻重的分量，偏偏两个继承人常年被传不和。
眼下两人同时出现在拍卖活动现场，视对方为空气，连招呼都不打一声的姿态也间接坐实了彼此不和的消息。
好事者们纷纷拿出手机往外递消息。
拍卖会已经开始，但今晚大家的关注显然已经偏离重点。

拍卖会宣布开始，展厅后排也传来好事者轻笑的声音——
"呵，周时聿和裴祤宁同时现身，今晚有好戏看了。"

点击文本中任意字符即可提交任务。`,
                typos: [
                    { start: 15, end: 16, incorrect: "坊", correct: "房" }
                ]
            }
        ];

        // 生成20个任务
        let tasks = [];
        for (let i = 1; i <= 20; i++) {
            const textIndex = (i - 1) % 2;
            const text = chineseTexts[textIndex];
            tasks.push({
                id: i,
                userId: 1,
                textId: text.id,
                reward: "48.00",
                status: "completed", // 默认所有任务已完成
                foundTypos: 7,
                totalTypos: 7,
                timeSpent: 0
            });
        }

        let currentTask = null;
        let clickedChars = new Set();

        // 初始化应用（完全按照线上版本逻辑）
        function init() {
            // 默认显示所有任务为已完成状态，符合线上版本用户数据
            tasks.forEach(task => {
                task.status = 'completed';
            });
            userData.completed = 20;
            userData.balance = "960.00"; // 20个任务 × 48.00 = 960.00
            updateUI();
            loadTasks();
        }

        // 更新UI显示
        function updateUI() {
            document.getElementById('balance').textContent = userData.balance;
            document.getElementById('completed').textContent = userData.completed;
        }

        // 加载任务列表
        function loadTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            tasks.forEach((task, index) => {
                const isCompleted = task.status === 'completed';
                const taskElement = document.createElement('div');
                taskElement.className = 'task-card';
                taskElement.onclick = () => !isCompleted && openTask(task.id);
                
                taskElement.innerHTML = `
                    <div class="task-card-content">
                        <div class="task-left">
                            <div class="task-icon ${isCompleted ? 'completed' : 'pending'}">
                                ${isCompleted ? '✓' : '📖'}
                            </div>
                            <div class="task-details">
                                <h3>非强迫宠爱第${task.id}章</h3>
                                <p class="${isCompleted ? 'completed' : ''}">
                                    ${isCompleted ? '已完成 - 已到账' : '请在规定时间内完成'}
                                </p>
                            </div>
                        </div>
                        <div class="task-right">
                            <div class="task-reward ${isCompleted ? 'completed' : 'pending'}">
                                +${task.reward}
                            </div>
                            <button class="task-action-btn ${isCompleted ? 'completed' : 'pending'}" 
                                    onclick="event.stopPropagation(); ${!isCompleted ? 'openTask(' + task.id + ')' : ''}"
                                    ${isCompleted ? 'disabled' : ''}>
                                ${isCompleted ? '已完成' : '进行修改'}
                            </button>
                        </div>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
            });
        }

        // 领取任务功能（重置所有任务状态）
        function handleResetTasks() {
            // 重置所有任务为pending状态
            tasks.forEach(task => {
                task.status = 'pending';
                task.foundTypos = 0;
            });
            
            // 重置用户数据
            userData.balance = "0.00";
            userData.completed = 0;
            
            // 更新UI
            updateUI();
            loadTasks();
            
            // 显示重置提示
            showRewardNotification("任务已重置");
        }

        // 打开任务模态框
        function openTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || task.status === 'completed') return;

            currentTask = task;
            clickedChars.clear();
            
            const textIndex = (taskId - 1) % 2;
            const text = chineseTexts[textIndex];
            
            document.getElementById('modalReward').textContent = task.reward;
            
            // 将文本内容转换为可点击的字符
            const content = text.content.replace(/第[12]章/, `第${taskId}章`);
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = content.split('').map((char, index) => 
                `<span onclick="handleCharClick(${index})">${char}</span>`
            ).join('');
            
            document.getElementById('taskModal').style.display = 'block';
        }

        // 处理字符点击
        function handleCharClick(charIndex) {
            const spans = document.querySelectorAll('#modalContent span');
            const span = spans[charIndex];
            
            if (clickedChars.has(charIndex)) {
                clickedChars.delete(charIndex);
                span.classList.remove('clicked');
            } else {
                clickedChars.add(charIndex);
                span.classList.add('clicked');
            }
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
            currentTask = null;
            clickedChars.clear();
        }

        // 提交任务
        function submitTask() {
            if (!currentTask) return;

            // 检查是否点击了文本字符
            if (clickedChars.size === 0) {
                alert('请先点击文本中的字符再提交');
                return;
            }

            // 标记任务为已完成
            currentTask.status = 'completed';
            currentTask.foundTypos = clickedChars.size;
            
            // 更新用户余额和完成数（固定奖励48.00）
            const currentBalance = parseFloat(userData.balance);
            const reward = 48.00;
            userData.balance = (currentBalance + reward).toFixed(2);
            userData.completed++;
            
            // 保存当前任务奖励用于显示
            const taskReward = currentTask.reward;
            
            // 关闭模态框
            closeModal();
            
            // 重新加载任务列表
            loadTasks();
            updateUI();
            
            // 显示奖励通知
            showRewardNotification(taskReward);
        }

        // 显示奖励通知
        function showRewardNotification(amount) {
            document.getElementById('rewardAmount').textContent = amount.startsWith('+') ? amount : `+${amount}`;
            const notification = document.getElementById('rewardNotification');
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // 页面加载时初始化
        window.addEventListener('load', init);
    </script>
</body>
</html>
